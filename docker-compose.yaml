version: '3.8'

services:
  # app:
  #   build: .
  #   container_name: pdf-vectorizer
  #   environment:
  #     QDRANT_HOST: qdrant
  #     QDRANT_PORT: 6333
  #     OPENAI_API_KEY: ${OPENAI_API_KEY}
  #     EMBEDDING_MODEL: text-embedding-3-small
  #     EMBEDDING_DIM: 1536
  #     QDRANT_COLLECTION: pdf_documents
  #     MINIO_HOST: ${MINIO_HOST}
  #     MINIO_PORT: ${MINIO_PORT}
  #     MINIO_ROOT_USER: ${MINIO_ROOT_USER}
  #     MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD}
  #     MINIO_BUCKET: ${MINIO_BUCKET}
  #   ports:
  #     - "8000:8000"
  #   volumes:
  #     - ./app:/app/app
  #   env_file:
  #     - .env
  #   depends_on:
  #     - qdrant
  #     - minio
  #   networks:
  #     - pdf-vectorizer-net

  qdrant:
    image: qdrant/qdrant:latest
    ports:
      - "6333:6333"
    volumes:
      - qdrant_storage:/qdrant/storage
    networks:
      - pdf-vectorizer-net

  minio:
    image: minio/minio:latest
    ports:
      - "9000:9000"
      - "9001:9001"
    volumes:
      - minio_storage:/data
    environment:
      MINIO_ROOT_USER: ${MINIO_ROOT_USER}
      MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD}
    command: server /data --console-address ":9001"
    networks:
      - pdf-vectorizer-net

  createbuckets:
    image: minio/mc
    depends_on:
      - minio
    entrypoint: >
      /bin/sh -c "
      /usr/bin/mc alias set myminio http://minio:9000 ${MINIO_ROOT_USER} ${MINIO_ROOT_PASSWORD};
      /usr/bin/mc mb myminio/docs;
      /usr/bin/mc policy set public myminio/docs;
      "
    networks:
      - pdf-vectorizer-net

networks:
  pdf-vectorizer-net:
    driver: bridge

volumes:
  qdrant_storage:
  minio_storage: